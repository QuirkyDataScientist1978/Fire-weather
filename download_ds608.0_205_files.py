#!/usr/bin/env python
#################################################################
# Python Script to retrieve 252 online Data files of 'ds608.0',
# total 169.01G. This script uses 'requests' to download data.
#
# Highlight this script by Select All, Copy and Paste it into a file;
# make the file executable and run it on command line.
#
# You need pass in your password as a parameter to execute
# this script; or you can set an environment variable RDAPSWD
# if your Operating System supports it.
#
# Contact chifan@ucar.edu (Chi-Fan Shih) for further assistance.
#################################################################


import sys, os
import requests

def check_file_status(filepath, filesize):
    sys.stdout.write('\r')
    sys.stdout.flush()
    size = int(os.stat(filepath).st_size)
    percent_complete = (size/filesize)*100
    sys.stdout.write('%.3f %s' % (percent_complete, '% Completed'))
    sys.stdout.flush()

# Try to get password
if len(sys.argv) < 2 and not 'RDAPSWD' in os.environ:
    try:
        import getpass
        input = getpass.getpass
    except:
        try:
            input = raw_input
        except:
            pass
    pswd = input('Password: ')
else:
    try:
        pswd = sys.argv[1]
    except:
        pswd = os.environ['RDAPSWD']

url = 'https://rda.ucar.edu/cgi-bin/login'
values = {'email' : 'daniel.b.potter@gmail.com', 'passwd' : pswd, 'action' : 'login'}
# Authenticate
ret = requests.post(url,data=values)
if ret.status_code != 200:
    print('Bad Authentication')
    print(ret.text)
    exit(1)
dspath = 'http://rda.ucar.edu/data/ds608.0/'
filelist = [
'3HRLY/1979/NARR3D_197911_0406.tar',
'3HRLY/1979/NARR3D_197911_0709.tar',
'3HRLY/1979/NARR3D_197911_1012.tar',
'3HRLY/1979/NARR3D_197911_1315.tar',
'3HRLY/1979/NARR3D_197911_1618.tar',
'3HRLY/1979/NARR3D_197911_1921.tar',
'3HRLY/1979/NARR3D_197911_2224.tar',
'3HRLY/1979/NARR3D_197911_2527.tar',
'3HRLY/1979/NARR3D_197911_2830.tar',
'3HRLY/1979/NARR3D_197912_0103.tar',
'3HRLY/1979/NARR3D_197912_0406.tar',
'3HRLY/1979/NARR3D_197912_0709.tar',
'3HRLY/1979/NARR3D_197912_1012.tar',
'3HRLY/1979/NARR3D_197912_1315.tar',
'3HRLY/1979/NARR3D_197912_1618.tar',
'3HRLY/1979/NARR3D_197912_1921.tar',
'3HRLY/1979/NARR3D_197912_2224.tar',
'3HRLY/1979/NARR3D_197912_2527.tar',
'3HRLY/1979/NARR3D_197912_2831.tar',
'3HRLY/1979/NARRclm_197904_0130.tar',
'3HRLY/1979/NARRclm_197905_0131.tar',
'3HRLY/1979/NARRclm_197906_0130.tar',
'3HRLY/1979/NARRclm_197907_0131.tar',
'3HRLY/1979/NARRclm_197908_0131.tar',
'3HRLY/1979/NARRclm_197909_0130.tar',
'3HRLY/1979/NARRclm_197910_0131.tar',
'3HRLY/1979/NARRclm_197911_0130.tar',
'3HRLY/1979/NARRclm_197912_0131.tar',
'3HRLY/1979/NARRflx_197904_0108.tar',
'3HRLY/1979/NARRflx_197904_0916.tar',
'3HRLY/1979/NARRflx_197904_1724.tar',
'3HRLY/1979/NARRflx_197904_2530.tar',
'3HRLY/1979/NARRflx_197905_0108.tar',
'3HRLY/1979/NARRflx_197905_0916.tar',
'3HRLY/1979/NARRflx_197905_1724.tar',
'3HRLY/1979/NARRflx_197905_2531.tar',
'3HRLY/1979/NARRflx_197906_0108.tar',
'3HRLY/1979/NARRflx_197906_0916.tar',
'3HRLY/1979/NARRflx_197906_1724.tar',
'3HRLY/1979/NARRflx_197906_2530.tar',
'3HRLY/1979/NARRflx_197907_0108.tar',
'3HRLY/1979/NARRflx_197907_0916.tar',
'3HRLY/1979/NARRflx_197907_1724.tar',
'3HRLY/1979/NARRflx_197907_2531.tar',
'3HRLY/1979/NARRflx_197908_0108.tar',
'3HRLY/1979/NARRflx_197908_0916.tar',
'3HRLY/1979/NARRflx_197908_1724.tar',
'3HRLY/1979/NARRflx_197908_2531.tar',
'3HRLY/1979/NARRflx_197909_0108.tar',
'3HRLY/1979/NARRflx_197909_0916.tar',
'3HRLY/1979/NARRflx_197909_1724.tar',
'3HRLY/1979/NARRflx_197909_2530.tar',
'3HRLY/1979/NARRflx_197910_0108.tar',
'3HRLY/1979/NARRflx_197910_0916.tar',
'3HRLY/1979/NARRflx_197910_1724.tar',
'3HRLY/1979/NARRflx_197910_2531.tar',
'3HRLY/1979/NARRflx_197911_0108.tar',
'3HRLY/1979/NARRflx_197911_0916.tar',
'3HRLY/1979/NARRflx_197911_1724.tar',
'3HRLY/1979/NARRflx_197911_2530.tar',
'3HRLY/1979/NARRflx_197912_0108.tar',
'3HRLY/1979/NARRflx_197912_0916.tar',
'3HRLY/1979/NARRflx_197912_1724.tar',
'3HRLY/1979/NARRflx_197912_2531.tar',
'3HRLY/1979/NARRpbl_197904_0109.tar',
'3HRLY/1979/NARRpbl_197904_1019.tar',
'3HRLY/1979/NARRpbl_197904_2030.tar',
'3HRLY/1979/NARRpbl_197905_0109.tar',
'3HRLY/1979/NARRpbl_197905_1019.tar',
'3HRLY/1979/NARRpbl_197905_2031.tar',
'3HRLY/1979/NARRpbl_197906_0109.tar',
'3HRLY/1979/NARRpbl_197906_1019.tar',
'3HRLY/1979/NARRpbl_197906_2030.tar',
'3HRLY/1979/NARRpbl_197907_0109.tar',
'3HRLY/1979/NARRpbl_197907_1019.tar',
'3HRLY/1979/NARRpbl_197907_2031.tar',
'3HRLY/1979/NARRpbl_197908_0109.tar',
'3HRLY/1979/NARRpbl_197908_1019.tar',
'3HRLY/1979/NARRpbl_197908_2031.tar',
'3HRLY/1979/NARRpbl_197909_0109.tar',
'3HRLY/1979/NARRpbl_197909_1019.tar',
'3HRLY/1979/NARRpbl_197909_2030.tar',
'3HRLY/1979/NARRpbl_197910_0109.tar',
'3HRLY/1979/NARRpbl_197910_1019.tar',
'3HRLY/1979/NARRpbl_197910_2031.tar',
'3HRLY/1979/NARRpbl_197911_0109.tar',
'3HRLY/1979/NARRpbl_197911_1019.tar',
'3HRLY/1979/NARRpbl_197911_2030.tar',
'3HRLY/1979/NARRpbl_197912_0109.tar',
'3HRLY/1979/NARRpbl_197912_1019.tar',
'3HRLY/1979/NARRpbl_197912_2031.tar',
'3HRLY/1979/NARRsfc_197904_0109.tar',
'3HRLY/1979/NARRsfc_197904_1019.tar',
'3HRLY/1979/NARRsfc_197904_2030.tar',
'3HRLY/1979/NARRsfc_197905_0109.tar',
'3HRLY/1979/NARRsfc_197905_1019.tar',
'3HRLY/1979/NARRsfc_197905_2031.tar',
'3HRLY/1979/NARRsfc_197906_0109.tar',
'3HRLY/1979/NARRsfc_197906_1019.tar',
'3HRLY/1979/NARRsfc_197906_2030.tar',
'3HRLY/1979/NARRsfc_197907_0109.tar',
'3HRLY/1979/NARRsfc_197907_1019.tar',
'3HRLY/1979/NARRsfc_197907_2031.tar',
'3HRLY/1979/NARRsfc_197908_0109.tar',
'3HRLY/1979/NARRsfc_197908_1019.tar',
'3HRLY/1979/NARRsfc_197908_2031.tar',
'3HRLY/1979/NARR3D_197901_0103.tar',
'3HRLY/1979/NARRsfc_197909_0109.tar',
'3HRLY/1979/NARR3D_197901_0406.tar',
'3HRLY/1979/NARRsfc_197909_1019.tar',
'3HRLY/1979/NARR3D_197901_0709.tar',
'3HRLY/1979/NARRsfc_197909_2030.tar',
'3HRLY/1979/NARR3D_197901_1012.tar',
'3HRLY/1979/NARRsfc_197910_0109.tar',
'3HRLY/1979/NARR3D_197901_1315.tar',
'3HRLY/1979/NARRsfc_197910_1019.tar',
'3HRLY/1979/NARR3D_197901_1618.tar',
'3HRLY/1979/NARRsfc_197910_2031.tar',
'3HRLY/1979/NARR3D_197901_1921.tar',
'3HRLY/1979/NARRsfc_197911_0109.tar',
'3HRLY/1979/NARR3D_197901_2224.tar',
'3HRLY/1979/NARRsfc_197911_1019.tar',
'3HRLY/1979/NARR3D_197901_2527.tar',
'3HRLY/1979/NARRsfc_197911_2030.tar',
'3HRLY/1979/NARR3D_197901_2831.tar',
'3HRLY/1979/NARRsfc_197912_0109.tar',
'3HRLY/1979/NARR3D_197902_0103.tar',
'3HRLY/1979/NARRsfc_197912_1019.tar',
'3HRLY/1979/NARR3D_197902_0406.tar',
'3HRLY/1979/NARRsfc_197912_2031.tar',
'3HRLY/1979/NARR3D_197902_0709.tar',
'3HRLY/1979/NARR3D_197902_1012.tar',
'3HRLY/1979/NARR3D_197902_1315.tar',
'3HRLY/1979/NARR3D_197902_1618.tar',
'3HRLY/1979/NARR3D_197902_1921.tar',
'3HRLY/1979/NARR3D_197902_2224.tar',
'3HRLY/1979/NARR3D_197902_2527.tar',
'3HRLY/1979/NARR3D_197902_2828.tar',
'3HRLY/1979/NARR3D_197903_0103.tar',
'3HRLY/1979/NARR3D_197903_0406.tar',
'3HRLY/1979/NARR3D_197903_0709.tar',
'3HRLY/1979/NARR3D_197903_1012.tar',
'3HRLY/1979/NARR3D_197903_1315.tar',
'3HRLY/1979/NARR3D_197903_1618.tar',
'3HRLY/1979/NARR3D_197903_1921.tar',
'3HRLY/1979/NARR3D_197903_2224.tar',
'3HRLY/1979/NARR3D_197903_2527.tar',
'3HRLY/1979/NARR3D_197903_2831.tar',
'3HRLY/1979/NARRclm_197901_0131.tar',
'3HRLY/1979/NARRclm_197902_0128.tar',
'3HRLY/1979/NARRclm_197903_0131.tar',
'3HRLY/1979/NARRflx_197901_0108.tar',
'3HRLY/1979/NARRflx_197901_0916.tar',
'3HRLY/1979/NARRflx_197901_1724.tar',
'3HRLY/1979/NARRflx_197901_2531.tar',
'3HRLY/1979/NARRflx_197902_0108.tar',
'3HRLY/1979/NARRflx_197902_0916.tar',
'3HRLY/1979/NARRflx_197902_1724.tar',
'3HRLY/1979/NARRflx_197902_2528.tar',
'3HRLY/1979/NARRflx_197903_0108.tar',
'3HRLY/1979/NARRflx_197903_0916.tar',
'3HRLY/1979/NARRflx_197903_1724.tar',
'3HRLY/1979/NARRflx_197903_2531.tar',
'3HRLY/1979/NARRpbl_197901_0109.tar',
'3HRLY/1979/NARRpbl_197901_1019.tar',
'3HRLY/1979/NARRpbl_197901_2031.tar',
'3HRLY/1979/NARRpbl_197902_0109.tar',
'3HRLY/1979/NARRpbl_197902_1019.tar',
'3HRLY/1979/NARRpbl_197902_2028.tar',
'3HRLY/1979/NARRpbl_197903_0109.tar',
'3HRLY/1979/NARRpbl_197903_1019.tar',
'3HRLY/1979/NARRpbl_197903_2031.tar',
'3HRLY/1979/NARRsfc_197901_0109.tar',
'3HRLY/1979/NARRsfc_197901_1019.tar',
'3HRLY/1979/NARRsfc_197901_2031.tar',
'3HRLY/1979/NARRsfc_197902_0109.tar',
'3HRLY/1979/NARRsfc_197902_1019.tar',
'3HRLY/1979/NARRsfc_197902_2028.tar',
'3HRLY/1979/NARRsfc_197903_0109.tar',
'3HRLY/1979/NARRsfc_197903_1019.tar',
'3HRLY/1979/NARRsfc_197903_2031.tar',
'3HRLY/1979/NARR3D_197904_0103.tar',
'3HRLY/1979/NARR3D_197904_0406.tar',
'3HRLY/1979/NARR3D_197904_0709.tar',
'3HRLY/1979/NARR3D_197904_1012.tar',
'3HRLY/1979/NARR3D_197904_1315.tar',
'3HRLY/1979/NARR3D_197904_1618.tar',
'3HRLY/1979/NARR3D_197904_1921.tar',
'3HRLY/1979/NARR3D_197904_2224.tar',
'3HRLY/1979/NARR3D_197904_2527.tar',
'3HRLY/1979/NARR3D_197904_2830.tar',
'3HRLY/1979/NARR3D_197905_0103.tar',
'3HRLY/1979/NARR3D_197905_0406.tar',
'3HRLY/1979/NARR3D_197905_0709.tar',
'3HRLY/1979/NARR3D_197905_1012.tar',
'3HRLY/1979/NARR3D_197905_1315.tar',
'3HRLY/1979/NARR3D_197905_1618.tar',
'3HRLY/1979/NARR3D_197905_1921.tar',
'3HRLY/1979/NARR3D_197905_2224.tar',
'3HRLY/1979/NARR3D_197905_2527.tar',
'3HRLY/1979/NARR3D_197905_2831.tar',
'3HRLY/1979/NARR3D_197906_0103.tar',
'3HRLY/1979/NARR3D_197906_0406.tar',
'3HRLY/1979/NARR3D_197906_0709.tar',
'3HRLY/1979/NARR3D_197906_1012.tar',
'3HRLY/1979/NARR3D_197906_1315.tar',
'3HRLY/1979/NARR3D_197906_1618.tar',
'3HRLY/1979/NARR3D_197906_1921.tar',
'3HRLY/1979/NARR3D_197906_2224.tar',
'3HRLY/1979/NARR3D_197906_2527.tar',
'3HRLY/1979/NARR3D_197906_2830.tar',
'3HRLY/1979/NARR3D_197907_0103.tar',
'3HRLY/1979/NARR3D_197907_0406.tar',
'3HRLY/1979/NARR3D_197907_0709.tar',
'3HRLY/1979/NARR3D_197907_1012.tar',
'3HRLY/1979/NARR3D_197907_1315.tar',
'3HRLY/1979/NARR3D_197907_1618.tar',
'3HRLY/1979/NARR3D_197907_1921.tar',
'3HRLY/1979/NARR3D_197907_2224.tar',
'3HRLY/1979/NARR3D_197907_2527.tar',
'3HRLY/1979/NARR3D_197907_2831.tar',
'3HRLY/1979/NARR3D_197908_0103.tar',
'3HRLY/1979/NARR3D_197908_0406.tar',
'3HRLY/1979/NARR3D_197908_0709.tar',
'3HRLY/1979/NARR3D_197908_1012.tar',
'3HRLY/1979/NARR3D_197908_1315.tar',
'3HRLY/1979/NARR3D_197908_1618.tar',
'3HRLY/1979/NARR3D_197908_1921.tar',
'3HRLY/1979/NARR3D_197908_2224.tar',
'3HRLY/1979/NARR3D_197908_2527.tar',
'3HRLY/1979/NARR3D_197908_2831.tar',
'3HRLY/1979/NARR3D_197909_0103.tar',
'3HRLY/1979/NARR3D_197909_0406.tar',
'3HRLY/1979/NARR3D_197909_0709.tar',
'3HRLY/1979/NARR3D_197909_1012.tar',
'3HRLY/1979/NARR3D_197909_1315.tar',
'3HRLY/1979/NARR3D_197909_1618.tar',
'3HRLY/1979/NARR3D_197909_1921.tar',
'3HRLY/1979/NARR3D_197909_2224.tar',
'3HRLY/1979/NARR3D_197909_2527.tar',
'3HRLY/1979/NARR3D_197909_2830.tar',
'3HRLY/1979/NARR3D_197910_0103.tar',
'3HRLY/1979/NARR3D_197910_0406.tar',
'3HRLY/1979/NARR3D_197910_0709.tar',
'3HRLY/1979/NARR3D_197910_1012.tar',
'3HRLY/1979/NARR3D_197910_1315.tar',
'3HRLY/1979/NARR3D_197910_1618.tar',
'3HRLY/1979/NARR3D_197910_1921.tar',
'3HRLY/1979/NARR3D_197910_2224.tar',
'3HRLY/1979/NARR3D_197910_2527.tar',
'3HRLY/1979/NARR3D_197910_2831.tar',
'3HRLY/1979/NARR3D_197911_0103.tar']
for file in filelist:
    filename=dspath+file
    file_base = os.path.basename(file)
    print('Downloading',file_base)
    req = requests.get(filename, cookies = ret.cookies, allow_redirects=True, stream=True)
    filesize = int(req.headers['Content-length'])
    with open(file_base, 'wb') as outfile:
        chunk_size=1048576
        for chunk in req.iter_content(chunk_size=chunk_size):
            outfile.write(chunk)
            if chunk_size < filesize:
                check_file_status(file_base, filesize)
    check_file_status(file_base, filesize)
    print()
